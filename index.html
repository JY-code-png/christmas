<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merry Christmas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #020205; /* Ê∑±Â§úÈªëËÉåÊôØ */
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
        }

        /* ÈÅÆÁΩ©Â±Ç */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s ease;
            cursor: pointer;
        }
        
        #btn-play {
            padding: 15px 40px;
            font-size: 20px;
            border: 2px solid #ff3366;
            color: #ff3366;
            background: transparent;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 15px #ff3366;
            animation: breathe 2s infinite;
            font-weight: bold;
        }

        @keyframes breathe {
            0%, 100% { box-shadow: 0 0 10px #ff3366; }
            50% { box-shadow: 0 0 25px #ff3366; transform: scale(1.05); }
        }

        /* Á•ùÁ¶èËØ≠ÂÆπÂô® */
        #text-container {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            width: 90%;
            max-width: 600px;
        }

        .typing-line {
            font-size: 1.2rem;
            margin: 8px 0;
            min-height: 1.5em;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .highlight { color: #FFD700; text-shadow: 0 0 10px #FFD700; font-weight: bold; font-size: 1.6rem;}
        .name { color: #00ffff; text-shadow: 0 0 10px #00ffff; font-size: 1.4rem; margin-bottom: 15px;}

        canvas { display: block; }
    </style>
</head>
<body>

    <!-- Èü≥‰πê -->
    <audio id="bgm" src="./bgm.mp3" loop></audio>

    <!-- ÈÅÆÁΩ©Â±Ç -->
    <div id="overlay">
        <h1 style="color: #ff3366; text-shadow: 0 0 20px #ff3366; margin-bottom: 20px;">üéÑ Christmas Party</h1>
        <p style="color: #ccc; margin-bottom: 30px;">Waiting for you...</p>
        <button id="btn-play">ÁÇπÊàëÂºÄÂêØ / START</button>
    </div>

    <!-- ÊñáÂ≠óÊòæÁ§∫Âå∫Âüü -->
    <div id="text-container"></div>

    <script>
        // === Á•ùÁ¶èËØ≠ÈÖçÁΩÆ ===
        const messages = [
            { text: "TO: Jack yang", class: "name" },
            { text: "Merry Christmas üéÑ", class: "highlight" },
            { text: "ÊÑø‰Ω†Âπ≥ÂÆâÂñú‰πêÔºå‰∏á‰∫ãËÉúÊÑè ‚ú®", class: "" },
            { text: "ÊâÄÊ±ÇÁöÜÂ¶ÇÊÑøÔºåÊó•Êó•Â∏∏Ê¨¢ÊÑâ üç¨", class: "" },
            { text: "Áà±‰Ω†Ê∞∏Ëøú ‚ù§Ô∏è", class: "" },
            { text: "From: fish", class: "name" }
        ];

        // === Ê†∏ÂøÉÂèòÈáè ===
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const bgm = document.getElementById('bgm');
        const textContainer = document.getElementById('text-container');

        let w, h;
        let particles = [];
        let angle = 0; 

        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // ÁÇπÂáª‰∫§‰∫í
        document.getElementById('btn-play').addEventListener('click', () => {
            bgm.play().catch(e => console.log(e));
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 1000);
            startTyping();
        });

        // ÊâìÂ≠óÊú∫ÊïàÊûú
        function startTyping() {
            let lineIndex = 0;
            function typeNextLine() {
                if (lineIndex >= messages.length) return;
                const msgData = messages[lineIndex];
                const p = document.createElement('p');
                p.className = `typing-line ${msgData.class || ''}`;
                textContainer.appendChild(p);
                requestAnimationFrame(() => p.style.opacity = '1');

                let charIndex = 0;
                const text = msgData.text;
                const timer = setInterval(() => {
                    if (charIndex < text.length) {
                        p.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(timer);
                        lineIndex++;
                        setTimeout(typeNextLine, 800);
                    }
                }, 100);
            }
            typeNextLine();
        }

        // === ‰∏áËÉΩÁ≤íÂ≠êÁ±ª (Ê†ë/Èõ™/Ê†ëÂπ≤/Á§ºÁâ©/‰∫∫) ===
        class Particle {
            constructor(type) {
                this.type = type;
                this.reset();
            }

            reset() {
                // 1. Âú£ËØûÊ†ëÂè∂Â≠ê
                if (this.type === 'tree') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.hPercent = Math.random(); // 0~1
                    // Ê†ëÁöÑÈ´òÂ∫¶ËåÉÂõ¥
                    this.y = h/2 + 150 - this.hPercent * 400; 
                    const maxR = 200;
                    this.r = (1 - this.hPercent) * maxR; 
                    
                    const rand = Math.random();
                    if (rand > 0.95) { this.color = '#FF4500'; this.size = 3.5; this.isDeco = true; } // Á∫¢ÁêÉ
                    else if (rand > 0.9) { this.color = '#FFD700'; this.size = 3; this.isDeco = true; } // ÈáëÁêÉ
                    else { 
                        const g = Math.floor(100 + Math.random() * 155);
                        this.color = `rgba(0, ${g}, 0, 0.8)`; 
                        this.size = 1.5; 
                        this.isDeco = false;
                    }
                } 
                // 2. Ê†ëÂπ≤ (Êñ∞Â¢û)
                else if (this.type === 'trunk') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.y = h/2 + 150 + Math.random() * 60; // Ê†ëÂ∫ïÂæÄ‰∏ãÂª∂‰º∏
                    this.r = Math.random() * 30; // Ê†ëÂπ≤Á≤óÁªÜ
                    this.color = `rgb(${60 + Math.random()*20}, ${30 + Math.random()*10}, 0)`; // Ê£ïËâ≤
                    this.size = 2;
                }
                // 3. Èõ™Ëä±
                else if (this.type === 'snow') {
                    this.x = Math.random() * w;
                    this.y = Math.random() * h;
                    this.z = Math.random() * 2 + 0.5;
                    this.size = Math.random() * 2;
                    this.color = 'rgba(255, 255, 255, 0.6)';
                }
                // 4. Á§ºÁâ©Áõí (Êñ∞Â¢û)
                else if (this.type === 'gift') {
                    this.angle = 0.5; // Âõ∫ÂÆö‰ΩçÁΩÆ
                    this.r = 100; // Á¶ª‰∏≠ÂøÉË∑ùÁ¶ª
                    this.y = h/2 + 180; // ÊîæÂú®Âú∞‰∏ä
                    this.size = 40; // Á§ºÁâ©Â§ßÂ∞è
                    this.emoji = "üéÅ";
                }
                // 5. Â∞èÂ•≥Â≠© (Êñ∞Â¢û)
                else if (this.type === 'girl1') {
                    this.angle = 2.5; // ÂàùÂßãËßíÂ∫¶
                    this.r = 140; 
                    this.y = h/2 + 180;
                    this.size = 35;
                    this.emoji = "üëß";
                }
                else if (this.type === 'girl2') {
                    this.angle = 2.8; // Á®çÂæÆÈîôÂºÄ‰∏ÄÁÇπÔºåÂÉèÊâãÊãâÊâã
                    this.r = 140; 
                    this.y = h/2 + 180;
                    this.size = 35;
                    this.emoji = "üëß";
                }
            }

            update() {
                if (this.type === 'snow') {
                    this.y += this.z;
                    if (this.y > h) this.y = -10;
                    this.x += Math.sin(Date.now() * 0.001 + this.z) * 0.5;
                    return;
                }

                // ÊóãËΩ¨ÈÄªËæë (Ê†ë„ÄÅÊ†ëÂπ≤„ÄÅ‰∫∫„ÄÅÁ§ºÁâ©ÈÉΩË¶ÅËΩ¨)
                let currentAngle = this.angle + angle;
                
                // ËÆ©Â∞èÂ•≥Â≠©Ë∑ëËµ∑Êù• (È¢ùÂ§ñÁöÑÂÖ¨ËΩ¨ÈÄüÂ∫¶)
                if (this.type === 'girl1' || this.type === 'girl2') {
                    currentAngle += angle * 1.5; // Ë∑ëÂæóÊØîÊ†ëËΩ¨ÂæóÂø´
                }

                this.drawX = w/2 + Math.cos(currentAngle) * this.r;
                this.drawZ = Math.sin(currentAngle) * this.r; // Ê∑±Â∫¶
                
                // 3DÈÄèËßÜÁº©Êîæ
                this.drawSize = this.size * (1 + this.drawZ / 600); 
                
                // ÈÄèÊòéÂ∫¶ÈöèÊ∑±Â∫¶ÂèòÂåñ (ËøúÂ§ÑÁöÑÂèòÊ∑°)
                this.alpha = 0.5 + (this.drawZ + 200) / 400;
                if(this.alpha > 1) this.alpha = 1;
                if(this.alpha < 0.2) this.alpha = 0.2;
            }

            draw() {
                if (this.type === 'snow') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    return;
                }

                // ÁªòÂà∂ Emoji (Á§ºÁâ©/‰∫∫)
                if (this.type === 'gift' || this.type.startsWith('girl')) {
                    ctx.font = `${this.drawSize}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.globalAlpha = this.alpha;
                    // Â∑¶Âè≥ÊëáÊëÜÂä®Áîª
                    let swing = 0;
                    if(this.type.startsWith('girl')) swing = Math.sin(Date.now() * 0.01) * 5; 
                    
                    ctx.save();
                    ctx.translate(this.drawX, this.y + swing);
                    ctx.fillText(this.emoji, 0, 0);
                    ctx.restore();
                    ctx.globalAlpha = 1;
                    return;
                }

                // ÁªòÂà∂ÂúÜÂΩ¢Á≤íÂ≠ê (Ê†ë/Ê†ëÂπ≤)
                ctx.beginPath();
                ctx.arc(this.drawX, this.y, this.drawSize, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                
                if (this.isDeco) {
                    ctx.shadowBlur = 10 * (1 + this.drawZ / 600);
                    ctx.shadowColor = this.color;
                } else {
                    ctx.shadowBlur = 0;
                }
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // ÂàùÂßãÂåñ
        function init() {
            // 1. Ê†ëÂπ≤ (500‰∏™Á≤íÂ≠ê)
            for(let i=0; i<500; i++) particles.push(new Particle('trunk'));
            // 2. Ê†ëÂè∂ (2500‰∏™Á≤íÂ≠ê)
            for(let i=0; i<2500; i++) particles.push(new Particle('tree'));
            // 3. Á§ºÁâ© (1‰∏™)
            particles.push(new Particle('gift'));
            // 4. Â∞èÂ•≥Â≠© (2‰∏™)
            particles.push(new Particle('girl1'));
            particles.push(new Particle('girl2'));
            // 5. Èõ™Ëä±
            for(let i=0; i<300; i++) particles.push(new Particle('snow'));
        }

        function drawTopStar() {
            const cx = w/2;
            const cy = h/2 + 150 - 410; // Ê†ëÈ°∂ÂùêÊ†á
            const outerR = 25;
            const innerR = 10;
            const spikes = 5;
            
            ctx.save();
            ctx.beginPath();
            ctx.translate(cx, cy);
            ctx.rotate(-Math.PI / 2);
            ctx.moveTo(outerR, 0);
            for (let i = 0; i < spikes * 2; i++) {
                const r = (i % 2 === 0) ? outerR : innerR;
                const a = (Math.PI * i) / spikes;
                ctx.lineTo(Math.cos(a) * r, Math.sin(a) * r);
            }
            ctx.closePath();
            ctx.fillStyle = "#FFD700";
            ctx.shadowBlur = 30 + Math.sin(Date.now()*0.005)*10; // ÂëºÂê∏Èó™ÁÉÅ
            ctx.shadowColor = "#FFD700";
            ctx.fill();
            ctx.restore();
        }

        function animate() {
            ctx.fillStyle = 'rgba(2, 2, 5, 0.6)'; // ÊãñÂ∞æÊïàÊûú
            ctx.fillRect(0, 0, w, h);

            angle += 0.01; // Êï¥‰ΩìÊóãËΩ¨ÈÄüÂ∫¶

            // Ê†∏ÂøÉÊäÄÊúØÔºöZËΩ¥ÊéíÂ∫è (Ëß£ÂÜ≥3DÈÅÆÊå°ÈóÆÈ¢ò)
            particles.sort((a, b) => {
                // Èõ™Ëä±‰∏çÂèÇ‰∏éÊéíÂ∫èÔºåÊ∞∏ËøúÂú®ÊúÄ‰∏äÂ±ÇÊàñÊúÄ‰∏ãÂ±Ç
                if(a.type === 'snow') return -1; 
                // ÂÖ∂‰ªñÁâ©‰ΩìÊåâZËΩ¥Ê∑±Â∫¶ÊéíÂ∫èÔºåËøúÁöÑÂÖàÁîªÔºåËøëÁöÑÂêéÁîª
                return (a.drawZ || -9999) - (b.drawZ || -9999);
            });

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawTopStar();
            requestAnimationFrame(animate);
        }

        init();
        animate();

    </script>
</body>
</html>
