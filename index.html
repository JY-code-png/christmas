<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merry Christmas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #020111 0%, #191b2e 100%); /* æ¸å˜å¤œç©ºèƒŒæ™¯ */
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
        }

        /* é®ç½©å±‚ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s ease;
            cursor: pointer;
        }
        
        #btn-play {
            padding: 15px 40px;
            font-size: 20px;
            border: 2px solid #FFD700;
            color: #FFD700;
            background: transparent;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 15px #FFD700;
            animation: breathe 2s infinite;
        }

        @keyframes breathe {
            0%, 100% { box-shadow: 0 0 10px #FFD700; transform: scale(1); }
            50% { box-shadow: 0 0 25px #FFD700; transform: scale(1.05); }
        }

        /* ç¥ç¦è¯­å®¹å™¨ */
        #text-container {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            width: 90%;
            max-width: 600px;
        }

        .typing-line {
            font-size: 1.1rem;
            margin: 8px 0;
            min-height: 1.5em;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .highlight { color: #FFD700; text-shadow: 0 0 15px #FFD700; font-weight: bold; font-size: 1.6rem;}
        .name { color: #00ffff; text-shadow: 0 0 10px #00ffff; font-size: 1.4rem; margin-bottom: 15px;}

        canvas { display: block; }
    </style>
</head>
<body>

    <!-- éŸ³ä¹ -->
    <audio id="bgm" src="./bgm.mp3" loop></audio>

    <!-- é®ç½©å±‚ -->
    <div id="overlay">
        <h1 style="color: #FFD700; text-shadow: 0 0 20px #FFD700; margin-bottom: 30px;">ğŸ„ Christmas Story...</h1>
        <button id="btn-play">ç‚¹å‡»å¼€å¯ / CLICK ME</button>
    </div>

    <!-- æ–‡å­—æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="text-container"></div>

    <script>
        // === 1. ç¥ç¦è¯­é…ç½® ===
        const messages = [
            { text: "TO: Jack yang", class: "name" },
            { text: "Merry Christmas ğŸ„", class: "highlight" },
            { text: "æ„¿ä½ å¹³å®‰å–œä¹ï¼Œä¸‡äº‹èƒœæ„ âœ¨", class: "" },
            { text: "æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ—¥æ—¥å¸¸æ¬¢æ„‰ ğŸ¬", class: "" },
            { text: "çˆ±ä½ æ°¸è¿œ â¤ï¸", class: "" },
            { text: "From: fish", class: "name" }
        ];

        // === 2. æ ¸å¿ƒåˆå§‹åŒ– ===
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const bgm = document.getElementById('bgm');
        const textContainer = document.getElementById('text-container');

        let w, h;
        let particles = [];
        let angle = 0; 
        let treeBottomY; // æ ‘åº•éƒ¨çš„Yåæ ‡

        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            treeBottomY = h / 2 + 180; // ç»Ÿä¸€å®šä¹‰æ ‘åº•ä½ç½®
        }
        window.addEventListener('resize', resize);
        resize();

        // äº¤äº’ï¼šç‚¹å‡»æ’­æ”¾
        document.getElementById('btn-play').addEventListener('click', () => {
            bgm.play().catch(e => console.log(e));
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 1000);
            startTyping();
        });

        // æ‰“å­—æœº
        function startTyping() {
            let lineIndex = 0;
            function typeNextLine() {
                if (lineIndex >= messages.length) return;
                const msgData = messages[lineIndex];
                const p = document.createElement('p');
                p.className = `typing-line ${msgData.class || ''}`;
                textContainer.appendChild(p);
                requestAnimationFrame(() => p.style.opacity = '1');

                let charIndex = 0;
                const timer = setInterval(() => {
                    if (charIndex < msgData.text.length) {
                        p.textContent += msgData.text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(timer);
                        lineIndex++;
                        setTimeout(typeNextLine, 800);
                    }
                }, 100);
            }
            typeNextLine();
        }

        // === 3. åœºæ™¯ç»˜åˆ¶é€»è¾‘ ===

        // æ ‘å¹²ç»˜åˆ¶
        function drawTrunk() {
            const trunkW = 40;
            const trunkH = 60;
            const x = w / 2 - trunkW / 2;
            const y = treeBottomY;
            
            // æ ‘å¹²æ¸å˜
            const grd = ctx.createLinearGradient(x, y, x + trunkW, y);
            grd.addColorStop(0, '#5D4037');
            grd.addColorStop(0.5, '#8D6E63');
            grd.addColorStop(1, '#5D4037');
            
            ctx.fillStyle = grd;
            ctx.fillRect(x, y, trunkW, trunkH);
        }

        // å¤§ç¤¼ç‰©ç»˜åˆ¶
        function drawBigGift() {
            const giftX = w / 2 - 30; // æ ‘å¹²å·¦ä¾§ä¸€ç‚¹
            const giftY = treeBottomY + 20; // æ”¾åœ¨åœ°ä¸Š
            const size = 50;

            // ç›’å­
            ctx.fillStyle = '#D32F2F'; // çº¢ç›’å­
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'red';
            ctx.fillRect(giftX, giftY, size, size * 0.8);
            ctx.shadowBlur = 0;

            // ä¸å¸¦ (é»„è‰²)
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(giftX + size/2 - 5, giftY, 10, size * 0.8); // ç«–çº¿
            ctx.fillRect(giftX, giftY + size * 0.4 - 5, size, 10); // æ¨ªçº¿
            
            // è´è¶ç»“
            ctx.beginPath();
            ctx.arc(giftX + size/2, giftY, 10, 0, Math.PI * 2);
            ctx.fill();
        }

        // ä¸¤ä¸ªå°å¥³å­©ç»˜åˆ¶ (ç”¨ Canvas ç”»ç®€å•çš„å‰ªå½±é£)
        function drawGirls() {
            const centerX = w / 2;
            const groundY = treeBottomY + 60; // åœ°é¢é«˜åº¦
            
            // å‘¼å¸åŠ¨ç”»å‚æ•° (è®©å¥¹ä»¬è½»å¾®æ‘‡æ‘†)
            const time = Date.now() * 0.002;
            const sway = Math.sin(time) * 2; 

            // ç»˜åˆ¶å•ä¸ªå¥³å­©å‡½æ•°
            function drawGirl(x, height, color, isLeft) {
                ctx.save();
                ctx.translate(x, groundY);
                ctx.rotate(sway * 0.02 * (isLeft ? 1 : -1)); // ç¨å¾®åå‘æ‘‡æ‘†

                // èº«ä½“ (æ¢¯å½¢è£™å­)
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(0, -height); // è„–å­
                ctx.lineTo(-15, 0);     // è£™æ‘†å·¦
                ctx.lineTo(15, 0);      // è£™æ‘†å³
                ctx.closePath();
                ctx.fill();

                // å¤´ (åœ†)
                ctx.beginPath();
                ctx.arc(0, -height - 8, 8, 0, Math.PI * 2);
                ctx.fill();

                // èƒ³è†Š (ç‰µæ‰‹)
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(0, -height + 5);
                // æ‰‹è‡‚ä¼¸å‘ä¸­é—´
                ctx.lineTo(isLeft ? 15 : -15, -height + 10);
                ctx.stroke();

                ctx.restore();
            }

            // å¥³å­© 1 (å·¦è¾¹) - ç¨å¾®ç²‰ä¸€ç‚¹
            drawGirl(centerX - 60, 45, '#F48FB1', true);
            
            // å¥³å­© 2 (å³è¾¹) - ç¨å¾®ç´«ä¸€ç‚¹
            drawGirl(centerX + 60, 45, '#CE93D8', false);

            // çˆ±å¿ƒåœ¨å¥¹ä»¬ä¸­é—´è·³åŠ¨
            const scale = 1 + Math.sin(time * 3) * 0.2;
            ctx.save();
            ctx.translate(centerX, groundY - 40);
            ctx.scale(scale, scale);
            ctx.fillStyle = '#FF4081';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#FF4081';
            ctx.beginPath();
            // ç”»å¿ƒå½¢
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(-5, -5, -10, 0, 0, 10);
            ctx.bezierCurveTo(10, 0, 5, -5, 0, 0);
            ctx.fill();
            ctx.restore();
        }

        // === 4. ç²’å­ç³»ç»Ÿ (æ ‘ + é›ª) ===
        class Particle {
            constructor(type) {
                this.type = type; 
                this.reset();
            }

            reset() {
                if (this.type === 'tree') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.hPercent = Math.random(); 
                    // æ ‘çš„é«˜åº¦èŒƒå›´ï¼štreeBottomY å¾€ä¸Šæ•° 500
                    this.y = treeBottomY - this.hPercent * 500; 
                    
                    const maxR = 220;
                    this.r = (1 - this.hPercent) * maxR; // é¡¶ç«¯åŠå¾„å°ï¼Œåº•ç«¯åŠå¾„å¤§
                    
                    const rand = Math.random();
                    if (rand > 0.96) { // ç¤¼ç‰©/å½©ç¯
                        this.color = `hsl(${Math.random() * 360}, 100%, 60%)`; // å½©è‰²ç¯
                        this.size = 3;
                        this.isDecoration = true;
                    } else if (rand > 0.9) { // é‡‘è‰²è£…é¥°
                        this.color = '#FFD700'; 
                        this.size = 2.5;
                        this.isDecoration = true;
                    } else { // å¶å­
                        const green = Math.floor(100 + Math.random() * 155);
                        this.color = `rgba(0, ${green}, 0, 0.8)`;
                        this.size = 1.5;
                        this.isDecoration = false;
                    }
                } else { // é›ªèŠ±
                    this.x = Math.random() * w;
                    this.y = Math.random() * h;
                    this.z = Math.random() * 2 + 0.5; 
                    this.size = Math.random() * 2;
                    this.color = 'rgba(255, 255, 255, 0.6)';
                }
            }

            update() {
                if (this.type === 'tree') {
                    this.drawX = w/2 + Math.cos(this.angle + angle) * this.r;
                    this.drawZ = Math.sin(this.angle + angle) * this.r; 
                    this.drawSize = this.size * (1 + this.drawZ / 500); 
                } else {
                    this.y += this.z;
                    if (this.y > h) this.y = -10;
                    this.x += Math.sin(Date.now() * 0.001 + this.z) * 0.5;
                }
            }

            draw() {
                if (this.type === 'tree') {
                    ctx.beginPath();
                    ctx.arc(this.drawX, this.y, this.drawSize, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    if (this.isDecoration && this.drawZ > 0) { // åªè®©å‰é¢çš„ç¯å‘å…‰
                        ctx.shadowBlur = 8;
                        ctx.shadowColor = this.color;
                    } else {
                        ctx.shadowBlur = 0;
                    }
                    ctx.fill();
                    ctx.shadowBlur = 0;
                } else {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
        }

        // åˆå§‹åŒ–
        function init() {
            for(let i=0; i<2800; i++) particles.push(new Particle('tree'));
            for(let i=0; i<200; i++) particles.push(new Particle('snow'));
        }

        // é¡¶ç«¯å¤§æ˜Ÿæ˜Ÿ
        function drawTopStar() {
            const cx = w/2;
            const cy = treeBottomY - 500; // æ ‘é¡¶
            const outerR = 25;
            const innerR = 10;
            const spikes = 5;
            
            ctx.save();
            ctx.beginPath();
            ctx.translate(cx, cy);
            ctx.rotate(-Math.PI / 2);
            ctx.moveTo(outerR, 0);
            for (let i = 0; i < spikes * 2; i++) {
                const r = (i % 2 === 0) ? outerR : innerR;
                const a = (Math.PI * i) / spikes;
                ctx.lineTo(Math.cos(a) * r, Math.sin(a) * r);
            }
            ctx.closePath();
            ctx.fillStyle = "#FFD700";
            ctx.shadowBlur = 30;
            ctx.shadowColor = "#FFD700";
            ctx.fill();
            ctx.restore();
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.fillStyle = 'rgba(2, 1, 17, 0.6)'; // æ‹–å°¾æ•ˆæœ
            ctx.fillRect(0, 0, w, h);

            angle += 0.01; 

            // ç»˜åˆ¶èƒŒæ™¯å±‚ç‰©ä½“ (æ ‘å¹²ã€ç¤¼ç‰©ã€äºº)
            drawTrunk();
            drawBigGift();
            drawGirls();

            // æ’åºç²’å­ (3Dé®æŒ¡å…³ç³»)
            particles.sort((a, b) => {
                if(a.type !== 'tree' || b.type !== 'tree') return 0;
                return a.drawZ - b.drawZ;
            });

            // ç»˜åˆ¶ç²’å­
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawTopStar();
            requestAnimationFrame(animate);
        }

        init();
        animate();

    </script>
</body>
</html>
