<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merry Christmas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000510; /* æ·±è“é»‘è‰²èƒŒæ™¯ï¼Œæ›´æœ‰è´¨æ„Ÿ */
            font-family: 'Courier New', Courier, monospace; /* æ‰“å­—æœºå­—ä½“ */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
        }

        /* é®ç½©å±‚ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s ease;
            cursor: pointer;
        }
        
        #btn-play {
            padding: 15px 40px;
            font-size: 20px;
            border: 2px solid #0ff;
            color: #0ff;
            background: transparent;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 15px #0ff;
            animation: breathe 2s infinite;
        }

        @keyframes breathe {
            0%, 100% { box-shadow: 0 0 10px #0ff; }
            50% { box-shadow: 0 0 25px #0ff; transform: scale(1.05); }
        }

        /* ç¥ç¦è¯­å®¹å™¨ */
        #text-container {
            position: absolute;
            top: 15%; /* æ–‡å­—ä½ç½® */
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            width: 90%;
            max-width: 600px;
        }

        .typing-line {
            font-size: 1.2rem;
            margin: 10px 0;
            min-height: 1.5em; /* å ä½ï¼Œé˜²æ­¢è·³åŠ¨ */
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            opacity: 0; /* åˆå§‹éšè— */
            transition: opacity 0.5s;
        }
        
        /* ç‰¹æ®Šé¢œè‰²çš„å­— */
        .highlight { color: #FFD700; text-shadow: 0 0 10px #FFD700; font-weight: bold; font-size: 1.5rem;}
        .name { color: #00ffff; text-shadow: 0 0 10px #00ffff; font-size: 1.8rem; margin-bottom: 20px;}

        canvas { display: block; }
    </style>
</head>
<body>

    <!-- éŸ³ä¹ -->
    <audio id="bgm" src="./bgm.mp3" loop></audio>

    <!-- é®ç½©å±‚ -->
    <div id="overlay">
        <h1 style="color: #0ff; text-shadow: 0 0 20px #0ff; margin-bottom: 30px;">ğŸ„ Christmas Loading...</h1>
        <button id="btn-play">ç‚¹å‡»å¼€å¯ / CLICK ME</button>
    </div>

    <!-- æ–‡å­—æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="text-container"></div>

    <script>
        // === é…ç½®åŒºåŸŸï¼šåœ¨è¿™é‡Œä¿®æ”¹ä½ çš„ç¥ç¦è¯­ ===
        const messages = [
            { text: "TO: Jack yang", class: "name" }, // åå­—
            { text: "Merry Christmas ğŸ„", class: "highlight" }, // æ ‡é¢˜
            { text: "æ„¿ä½ å¹³å®‰å–œä¹ï¼Œä¸‡äº‹èƒœæ„ âœ¨", class: "" },
            { text: "æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ—¥æ—¥å¸¸æ¬¢æ„‰ ğŸ¬", class: "" },
            { text: "çˆ±ä½ æ°¸è¿œ â¤ï¸", class: "" },
            { text: "From: fish", class: "name" } // è½æ¬¾
        ];

        // === æ ¸å¿ƒé€»è¾‘ ===
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const bgm = document.getElementById('bgm');
        const textContainer = document.getElementById('text-container');

        let w, h;
        let particles = [];
        let angle = 0; // æ—‹è½¬è§’åº¦

        // åˆå§‹åŒ–ç”»å¸ƒ
        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // äº¤äº’é€»è¾‘
        document.getElementById('btn-play').addEventListener('click', () => {
            // æ’­æ”¾éŸ³ä¹
            bgm.play().then(() => console.log("BGM playing")).catch(e => console.log(e));
            
            // éšè—é®ç½©
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 1000);

            // å¼€å§‹æ‰“å­—æœºæ•ˆæœ
            startTyping();
        });

        // === æ‰“å­—æœºæ•ˆæœå‡½æ•° ===
        function startTyping() {
            let lineIndex = 0;

            function typeNextLine() {
                if (lineIndex >= messages.length) return;

                const msgData = messages[lineIndex];
                const p = document.createElement('p');
                p.className = `typing-line ${msgData.class || ''}`;
                textContainer.appendChild(p);

                // ç«‹å³æ˜¾ç¤ºå®¹å™¨ï¼ˆæ·¡å…¥ï¼‰
                requestAnimationFrame(() => p.style.opacity = '1');

                let charIndex = 0;
                const text = msgData.text;
                
                // é€å­—æ‰“å°å®šæ—¶å™¨
                const timer = setInterval(() => {
                    if (charIndex < text.length) {
                        p.textContent += text.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(timer);
                        lineIndex++;
                        setTimeout(typeNextLine, 800); // æ¯ä¸€è¡Œæ‰“å®Œååœé¡¿800æ¯«ç§’å†æ‰“ä¸‹ä¸€è¡Œ
                    }
                }, 100); // æ‰“å­—é€Ÿåº¦ï¼šæ•°å€¼è¶Šå°è¶Šå¿«
            }

            typeNextLine();
        }

        // === 3D ç²’å­æ ‘é€»è¾‘ ===
        class Particle {
            constructor(type) {
                this.type = type; // 'tree' or 'snow'
                this.reset();
            }

            reset() {
                if (this.type === 'tree') {
                    // æ ‘çš„é€»è¾‘ï¼šåœ†é”¥èºæ—‹
                    this.angle = Math.random() * Math.PI * 2;
                    this.hPercent = Math.random(); // 0(åº•) åˆ° 1(é¡¶)
                    this.y = h/2 + 200 - this.hPercent * 500; // é«˜åº¦æ˜ å°„
                    
                    // åŠå¾„éšé«˜åº¦å˜å°
                    const maxR = 250;
                    this.r = (1 - this.hPercent) * maxR; 
                    
                    // éšæœºé¢œè‰²
                    const rand = Math.random();
                    if (rand > 0.95) {
                        this.color = '#FF4500'; // çº¢è‰²ç¤¼ç‰©/ç¯çƒ
                        this.size = 3.5;
                        this.isDecoration = true;
                    } else if (rand > 0.9) {
                        this.color = '#FFD700'; // é‡‘è‰²è£…é¥°
                        this.size = 3;
                        this.isDecoration = true;
                    } else {
                        // ç»¿è‰²æ ‘å¶ï¼Œå¸¦æœ‰æ·±æµ…å˜åŒ–
                        const green = Math.floor(100 + Math.random() * 155);
                        this.color = `rgba(0, ${green}, 0, 0.8)`;
                        this.size = 1.5;
                        this.isDecoration = false;
                    }
                } else {
                    // é›ªèŠ±é€»è¾‘
                    this.x = Math.random() * w;
                    this.y = Math.random() * h;
                    this.z = Math.random() * 2 + 0.5; // é€Ÿåº¦
                    this.size = Math.random() * 2;
                    this.color = 'rgba(255, 255, 255, 0.6)';
                }
            }

            update() {
                if (this.type === 'tree') {
                    // æ ‘æ—‹è½¬
                    this.drawX = w/2 + Math.cos(this.angle + angle) * this.r;
                    this.drawZ = Math.sin(this.angle + angle) * this.r; // æ·±åº¦
                    // ç®€å•çš„ 3D é€è§†å¤§å°å˜åŒ–
                    this.drawSize = this.size * (1 + this.drawZ / 500); 
                } else {
                    // é›ªèŠ±ä¸‹è½
                    this.y += this.z;
                    if (this.y > h) this.y = -10;
                    // é›ªèŠ±æ¨ªå‘é£˜åŠ¨
                    this.x += Math.sin(Date.now() * 0.001 + this.z) * 0.5;
                }
            }

            draw() {
                if (this.type === 'tree') {
                    // æ ‘ç²’å­
                    ctx.beginPath();
                    ctx.arc(this.drawX, this.y, this.drawSize, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    
                    // è£…é¥°ç‰©åŠ å‘å…‰æ•ˆæœ
                    if (this.isDecoration) {
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = this.color;
                    } else {
                        ctx.shadowBlur = 0;
                    }
                    ctx.fill();
                    ctx.shadowBlur = 0; // é‡ç½®
                } else {
                    // é›ªèŠ±ç²’å­
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
        }

        // åˆå§‹åŒ–ç²’å­
        function init() {
            // æ ‘ç²’å­æ•°é‡
            for(let i=0; i<2500; i++) particles.push(new Particle('tree'));
            // é›ªèŠ±æ•°é‡
            for(let i=0; i<300; i++) particles.push(new Particle('snow'));
        }

        // é¡¶éƒ¨çš„æ˜Ÿæ˜Ÿ
        function drawTopStar() {
            const cx = w/2;
            const cy = h/2 + 200 - 520; // æ ‘é¡¶é«˜åº¦
            const outerR = 25;
            const innerR = 10;
            const spikes = 5;
            
            ctx.save();
            ctx.beginPath();
            ctx.translate(cx, cy);
            ctx.rotate(-Math.PI / 2);
            ctx.moveTo(outerR, 0);
            for (let i = 0; i < spikes * 2; i++) {
                const r = (i % 2 === 0) ? outerR : innerR;
                const a = (Math.PI * i) / spikes;
                ctx.lineTo(Math.cos(a) * r, Math.sin(a) * r);
            }
            ctx.closePath();
            ctx.fillStyle = "#FFD700";
            ctx.shadowBlur = 30;
            ctx.shadowColor = "#FFD700";
            ctx.fill();
            ctx.restore();
        }

        function animate() {
            // æ¸…ç©ºç”»å¸ƒï¼ˆå¸¦é€æ˜åº¦æ‹–å°¾ï¼Œè®©æ—‹è½¬æ›´ä¸æ»‘ï¼‰
            ctx.fillStyle = 'rgba(0, 5, 16, 0.4)';
            ctx.fillRect(0, 0, w, h);

            angle += 0.01; // æ—‹è½¬é€Ÿåº¦

            // æŒ‰ç…§æ·±åº¦æ’åºï¼ˆä¸ºäº†æ­£ç¡®çš„é®æŒ¡å…³ç³»ï¼šåé¢çš„å…ˆç”»ï¼Œå‰é¢çš„åç”»ï¼‰
            particles.sort((a, b) => {
                if(a.type !== 'tree' || b.type !== 'tree') return 0;
                return a.drawZ - b.drawZ;
            });

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawTopStar();
            requestAnimationFrame(animate);
        }

        init();
        animate();

    </script>
</body>
</html>
