<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merry Christmas</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        /* é®ç½©å±‚æ ·å¼ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            color: white;
            transition: opacity 1s;
            cursor: pointer;
        }
        #overlay h1 {
            font-size: 3rem;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }
        #overlay p {
            font-size: 1.2rem;
            color: #ccc;
            border: 1px solid #fff;
            padding: 10px 20px;
            border-radius: 20px;
        }
        /* æ–‡å­—ç¥ç¦è¯­æ ·å¼ */
        #message-box {
            position: absolute;
            top: 10%;
            width: 100%;
            text-align: center;
            color: #C89568;
            font-family: "Times New Roman", serif;
            font-size: 24px;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            transition: opacity 2s;
        }
        canvas { display: block; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <!-- 1. ç‚¹å‡»æ’­æ”¾é®ç½© -->
    <div id="overlay">
        <h1>ğŸ„ Merry Christmas ğŸ„</h1>
        <p>ğŸ‘‡ ç‚¹å‡»å±å¹•ç‚¹äº®åœ£è¯æ ‘ / Click to Start</p>
    </div>

    <!-- 2. ç¥ç¦è¯­åŒºåŸŸ -->
    <div id="message-box">
        <p>Jack yang</p>
        <p>Merry Christmas</p>
        <p>æ„¿ä½ å¹³å®‰å–œä¹ï¼Œä¸‡äº‹èƒœæ„</p>
        <p>çˆ±ä½ æ°¸è¿œ</p>
    </div>

    <!-- 3. éŸ³ä¹æ–‡ä»¶ (ç¡®ä¿ä½ ä»“åº“é‡Œæœ‰ bgm.mp3) -->
    <audio id="bgm" src="./bgm.mp3" loop></audio>

    <script>
        // === æ ¸å¿ƒé€»è¾‘å¼€å§‹ ===
        const overlay = document.getElementById('overlay');
        const bgm = document.getElementById('bgm');
        const messageBox = document.getElementById('message-box');
        let isPlaying = false;

        // ç‚¹å‡»äº‹ä»¶ï¼šæ’­æ”¾éŸ³ä¹ã€éšè—é®ç½©ã€æ˜¾ç¤ºç¥ç¦
        overlay.addEventListener('click', () => {
            if (isPlaying) return;
            isPlaying = true;

            // æ’­æ”¾éŸ³ä¹
            bgm.play().then(() => {
                console.log("BGM playing");
            }).catch(err => {
                console.log("Music play failed:", err);
            });

            // éšè—é®ç½©
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                messageBox.style.opacity = '1'; // æ˜¾ç¤ºç¥ç¦è¯­
            }, 1000);
        });

        // === 3D èºæ—‹åœ£è¯æ ‘ Canvas åŠ¨ç”» ===
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // ç²’å­ç±»
        class Particle {
            constructor() {
                this.reset();
                this.y = Math.random() * height; // åˆå§‹éšæœºé«˜åº¦
            }
            
            reset() {
                this.angle = Math.random() * Math.PI * 2; // è§’åº¦
                this.radius = 0; // åŠå¾„
                this.y = height; // ä»åº•éƒ¨å¼€å§‹
                this.speed = Math.random() * 1 + 0.5; // ä¸Šå‡é€Ÿåº¦
                this.color = `hsl(${Math.random() * 50 + 100}, 100%, 50%)`; // ç»¿è‰²ç³»
                if(Math.random() > 0.95) this.color = '#FFD700'; // å¶å°”å‡ºç°é‡‘è‰²
                if(Math.random() > 0.98) this.color = '#FF0000'; // å¶å°”å‡ºç°çº¢è‰²
            }

            update() {
                this.y -= this.speed;
                // æ ‘çš„å½¢çŠ¶é€»è¾‘ï¼šè¶Šé«˜åŠå¾„è¶Šå°
                const maxRadius = (width < 600 ? width * 0.4 : 300); // æ‰‹æœºé€‚é…
                const treeHeight = height * 0.8;
                
                // è®¡ç®—å½“å‰é«˜åº¦å¯¹åº”çš„æœ€å¤§åŠå¾„
                let currentMaxRadius = maxRadius * ((this.y - (height - treeHeight)) / treeHeight);
                if (currentMaxRadius < 0) currentMaxRadius = 0;

                // èºæ—‹è¿åŠ¨
                this.angle += 0.02; 
                this.x = width / 2 + Math.cos(this.angle) * currentMaxRadius;
                this.z = Math.sin(this.angle) * currentMaxRadius; // æ¨¡æ‹Ÿæ·±åº¦
                
                // ç²’å­å¤§å°éšæ·±åº¦å˜åŒ– (3Dæ„Ÿ)
                this.size = (this.z + currentMaxRadius) / (currentMaxRadius * 2) * 3 + 1;

                // å¾ªç¯é‡ç½®
                if (this.y < height - treeHeight) {
                    this.reset();
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 5;
                ctx.shadowColor = this.color;
                ctx.fill();
            }
        }

        // åˆå§‹åŒ–ç²’å­
        function initParticles() {
            for (let i = 0; i < 600; i++) { // ç²’å­æ•°é‡
                particles.push(new Particle());
            }
        }

        // é¡¶éƒ¨çš„æ˜Ÿæ˜Ÿ
        function drawStar() {
            const treeTopY = height - (height * 0.8);
            const cx = width / 2;
            const cy = treeTopY;
            const spikes = 5;
            const outerRadius = 20;
            const innerRadius = 10;
            
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#FFD700';
            ctx.stroke();
            ctx.fillStyle = '#FFFF00';
            ctx.fill();
            
            // æ˜Ÿæ˜Ÿé—ªçƒå…‰æ™•
            ctx.shadowBlur = 20 + Math.sin(Date.now() * 0.005) * 10;
            ctx.shadowColor = "#FFD700";
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // èƒŒæ™¯å¾®é€æ˜ï¼Œå½¢æˆæ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawStar(); // ç”»æ˜Ÿæ˜Ÿ
            requestAnimationFrame(animate);
        }

        initParticles();
        animate();
    </script>
</body>
</html>
